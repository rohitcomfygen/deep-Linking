<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deep Link Test</title>
</head>

<body>
  <div id="app"></div>
  <script>
    const app = document.getElementById('app');
    const APP_SCHEME = `Eyision://news`;
    const PLAY_STORE = `https://play.google.com/store/apps/details?id=com.app.eysion`;
    const APP_STORE = `https://apps.apple.com/in/app/eyision/id6749613401`;

    function openApp() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const isAndroid = /android/i.test(userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(userAgent);

      let redirectTimer;

      // Cancel fallback if user leaves the browser (app opened)
      const cancelRedirect = () => clearTimeout(redirectTimer);
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) cancelRedirect();
      });
      window.addEventListener('pagehide', cancelRedirect);

      if (isAndroid) {
        // Use hidden iframe for Android
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = APP_SCHEME;
        document.body.appendChild(iframe);
      } else {
        // Use direct location change for iOS
        window.location = APP_SCHEME;
      }

      // Set fallback redirect to store if app didn't open
      redirectTimer = setTimeout(() => {
        window.location = isAndroid ? PLAY_STORE : APP_STORE;
      }, 2000);
    }

    app.innerHTML = `
      <h1>Deep Link Test Page</h1>
      <p>Path: ${window.location.pathname}</p>
      <p>Query: ${window.location.search}</p>
      <p>Full URL: ${window.location.href}</p>
      <button onclick="openApp()">Open App</button>
    `;
  </script>
</body>

</html>